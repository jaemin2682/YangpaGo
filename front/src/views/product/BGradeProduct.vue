<template>
  <div class="container-home">
    <h2 class="title">B급 농산물</h2>
     <div class="recommend">
        <FlexProductListItem
         :datas="products"
        />
        <infinite-loading
        slot="append"
        @infinite="infiniteHandler"
        force-use-infinite-wrapper=".el-table__body-wrapper"
        >
        </infinite-loading>
    </div>
  </div>
</template>

<script>
import FlexProductListItem from "@/components/product/FlexProductListItem.vue";
import InfiniteLoading from "vue-infinite-loading";
import axios from "axios";
import { mapGetters } from "vuex";
const SERVER_URL = "http://j3a404.p.ssafy.io:8081";
export default {
    components:{
      FlexProductListItem,
      InfiniteLoading,
    },
    data(){
      return{
        products:[],
        page: 1
      }
    },
    methods:{
      ...mapGetters({
            getEmail: "user/getEmail"
        }),
        infiniteHandler($state) {
        axios
            .get(
            `${SERVER_URL}/api/productlist/bgrade?page=${
                this.page
            }`
            )
            .then(response => {
            if (response.data.length) {
                this.products = this.products.concat(response.data);
                $state.loaded();
                this.page += 1;
                if (this.products.length / 9 == 0) {
                $state.complete();
                }
                console.log("여기"+response.data.length)
            } else {
                $state.complete();
            }
            })
            .catch(err => console.log(err));
        },
        fetchFirstdata(){
            axios
            .get(
            `${SERVER_URL}/api/productlist/bgrade?page=${  // 과잉 농산물 api 만들어지면 바꿀 예정
                this.page
            }`
            )
            .then(response => {
            if (response.data.length) {
                this.products = this.products.concat(response.data);
                this.page += 1;
            } 
            })
            .catch(err => console.log(err));
        },
    },
    mounted(){
      this.fetchFirstdata();
    }
}
</script>

<style lang="scss" scoped>
@import "@/assets/recipe/recipeHome.scss";
</style>